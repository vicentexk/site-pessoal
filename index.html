// ======== DARK MODE ========
const darkToggle = document.getElementById("darkToggle");
darkToggle.addEventListener("click", () => {
  document.body.classList.toggle("dark");
  darkToggle.textContent = document.body.classList.contains("dark") ? "ðŸŒ™" : "ðŸŒž";
});

// ======== ANIMAÃ‡ÃƒO DE DIGITAÃ‡ÃƒO ========
const typewriter = document.getElementById("typewriter");
const text = "Bem-vindo ao meu site pessoal!";
let index = 0;
function type() {
  if (index < text.length) {
    typewriter.textContent += text.charAt(index);
    index++;
    setTimeout(type, 80);
  }
}
type();

// ======== SCROLL ANIMADO ========
window.addEventListener("scroll", () => {
  document.querySelectorAll(".section").forEach(sec => {
    const top = sec.getBoundingClientRect().top;
    if (top < window.innerHeight - 100) sec.classList.add("visible");
  });
});

// ======== KONAMI CODE (â†‘â†‘â†“â†“â†â†’â†â†’Enter) ========
const secretBtn = document.getElementById("secretBtn");
const konamiCode = [
  "ArrowUp","ArrowUp","ArrowDown","ArrowDown",
  "ArrowLeft","ArrowRight","ArrowLeft","ArrowRight","Enter"
];
let input = [];

window.addEventListener("keydown", (e) => {
  input.push(e.key);
  if (input.length > konamiCode.length) input.shift();

  if (JSON.stringify(input) === JSON.stringify(konamiCode)) {
    showKonamiPopup();
  }
});

// ======== POPUP DE CÃ“DIGO ATIVADO ========
function showKonamiPopup() {
  const popup = document.createElement("div");
  popup.classList.add("popup");
  popup.innerHTML = `
    <div class="popup-content">
      <h3>âœ¨ CÃ³digo Secreto Ativado! âœ¨</h3>
      <p>VocÃª desbloqueou algo especial...</p>
    </div>
  `;
  document.body.appendChild(popup);
  popup.style.display = "flex";

  setTimeout(() => {
    popup.remove();
    secretBtn.style.display = "block";
  }, 2000);
}

// ======== MINI PONG ========
const popup = document.getElementById("gamePopup");
const closeGame = document.getElementById("closeGame");

secretBtn.addEventListener("click", () => {
  popup.style.display = "flex";
  startPong();
});

closeGame.addEventListener("click", () => {
  popup.style.display = "none";
  cancelAnimationFrame(pongAnimation);
});

let pongAnimation;
function startPong() {
  const canvas = document.getElementById("pong");
  const ctx = canvas.getContext("2d");

  const player = { x: 10, y: 120, w: 10, h: 60, dy: 0 };
  const ai = { x: 380, y: 120, w: 10, h: 60, dy: 2 };
  const ball = { x: 200, y: 150, r: 6, dx: 3, dy: 3 };

  document.addEventListener("keydown", e => {
    if (e.key === "ArrowUp") player.dy = -4;
    if (e.key === "ArrowDown") player.dy = 4;
  });
  document.addEventListener("keyup", e => {
    if (["ArrowUp", "ArrowDown"].includes(e.key)) player.dy = 0;
  });

  function drawRect(x, y, w, h, color) {
    ctx.fillStyle = color;
    ctx.fillRect(x, y, w, h);
  }

  function drawCircle(x, y, r, color) {
    ctx.fillStyle = color;
    ctx.beginPath();
    ctx.arc(x, y, r, 0, Math.PI * 2);
    ctx.fill();
  }

  function update() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    player.y += player.dy;
    player.y = Math.max(0, Math.min(canvas.height - player.h, player.y));

    ball.x += ball.dx;
    ball.y += ball.dy;

    if (ball.y < 0 || ball.y > canvas.height) ball.dy *= -1;
    if (ball.x - ball.r < player.x + player.w && ball.y > player.y && ball.y < player.y + player.h) {
      ball.dx *= -1;
      ball.x = player.x + player.w + ball.r;
    }
    if (ball.x + ball.r > ai.x && ball.y > ai.y && ball.y < ai.y + ai.h) {
      ball.dx *= -1;
      ball.x = ai.x - ball.r;
    }

    ai.y += (ball.y - (ai.y + ai.h/2)) * 0.05;
    if (ball.x < 0 || ball.x > canvas.width) {
      ball.x = 200; ball.y = 150; ball.dx *= -1;
    }

    drawRect(player.x, player.y, player.w, player.h, "#f6b93b");
    drawRect(ai.x, ai.y, ai.w, ai.h, "#85bb65");
    drawCircle(ball.x, ball.y, ball.r, "white");

    pongAnimation = requestAnimationFrame(update);
  }
  update();
}
